<!-- Launcher (only for standalone testing, hidden in iframe) -->
<button
  *ngIf="!inIframe"
  class="lexi-launcher"
  (click)="toggle()"
  [class.active]="open()"
  aria-label="Open chat"
>
  ✦
</button>

<!-- Chat Window -->
<div class="lexi-window" [class.open]="open()">
  <header class="lexi-header">
    <div class="lexi-title">
      <img src="assets/lexi-chat.png" alt="Lexi" class="lexi-logo" />
    </div>
    <button class="lexi-close" (click)="toggle()" aria-label="Close">✕</button>
  </header>

  <section class="lexi-body" role="log" aria-live="polite" #log>
    <div class="lexi-daystamp">{{ formatDaystamp() }}</div>
    <ng-container *ngFor="let m of messages(); let i = index">
      <div class="lexi-msg" [class.user]="m.role === 'user'">
        <div *ngIf="m.role !== 'user'" class="lexi-avatar">
          <img src="assets/lexi-logo.png" alt="Lexi" class="lexi-logo-only" />
        </div>
        <div class="lexi-col">
          <div class="lexi-meta">
            <span class="lexi-name">{{
              m.role === "user" ? "You" : assistantName
            }}</span>
            <span class="lexi-time">{{ formatTime(m, m.timestamp) }}</span>
          </div>
          <div class="lexi-bubble">{{ m.text }}</div>
        </div>
      </div>
    </ng-container>
  </section>

  <footer class="lexi-input">
    <div class="input-wrapper">
      <textarea
        #input
        placeholder="Type here..."
        [disabled]="sending()"
        (keydown)="keydown($event)"
        [ngModel]="text()"
        (ngModelChange)="text.set($event)"
      ></textarea>
      <button
        class="lexi-send"
        [disabled]="sending()"
        (click)="send()"
        aria-label="Send"
      >
        ➤
      </button>
    </div>
  </footer>
</div>
